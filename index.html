<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Algorithm Visualizer</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs/loader.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs/editor/editor.main.min.css">

  <style>
      :root {
          --primary: #6c5ce7;
          --secondary: #a8a5e6;
          --background: #1a1a2e;
          --surface: #16213e;
          --highlight: #ff6b6b;
      }

      body {
          margin: 0;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: var(--background);
          color: white;
      }

      header {
          background: linear-gradient(135deg, var(--primary), var(--secondary));
          padding: 1rem 2rem;
          font-size: 1.5rem;
          font-weight: bold;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      }

      #main-container {
          display: flex;
          flex: 1;
          gap: 20px;
          padding: 20px;
          flex-wrap: wrap;
      }

      #editor-container, #output-container {
          flex: 1;
          min-width: 300px;
          background: var(--surface);
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }

      #editor {
          height: 400px !important;
          border: 1px solid #444;
          border-radius: 4px;
          margin-top: 10px;
      }

      #arrayContainer {
          display: flex;
          align-items: flex-end;
          justify-content: center;
          min-height: 300px;
          height: 40vh;
          border-radius: 12px;
          background: var(--background);
          padding: 20px;
          margin-bottom: 20px;
          position: relative;
          overflow: hidden;
      }

      .bar {
          position: relative;
          background: linear-gradient(to top, var(--primary), var(--secondary));
          width: 30px;
          margin: 0 2px;
          border-radius: 6px 6px 0 0;
          text-align: center;
          font-size: 14px;
          font-weight: bold;
          color: white;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }

      .bar.comparing {
          background: linear-gradient(to top, #ff6b6b, #ff8e8e);
          transform: scaleY(1.05);
      }

      .bar.sorted {
          background: linear-gradient(to top, #4CAF50, #66BB6A);
      }

      .bar.pivot {
          background: linear-gradient(to top, #FFC107, #FFD54F);
      }

      .bar span {
          position: absolute;
          top: -25px;
          left: 50%;
          transform: translateX(-50%);
          color: rgba(255,255,255,0.8);
          font-size: 12px;
          white-space: nowrap;
          background: rgba(0,0,0,0.5);
          padding: 2px 5px;
          border-radius: 4px;
      }

      #controls {
          display: flex;
          gap: 10px;
          align-items: center;
          padding: 15px;
          background: var(--surface);
          border-radius: 8px;
          margin-bottom: 20px;
          flex-wrap: wrap;
      }

      button {
          padding: 8px 16px;
          background: linear-gradient(135deg, var(--primary), var(--secondary));
          border: none;
          border-radius: 6px;
          color: white;
          cursor: pointer;
          transition: all 0.2s ease;
          font-weight: 500;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          flex-shrink: 0;
      }

      button:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(108, 92, 231, 0.3);
      }

      select {
          padding: 8px 12px;
          background: var(--background);
          border: 1px solid rgba(255,255,255,0.1);
          border-radius: 6px;
          color: white;
          flex-shrink: 0;
      }

      #speedControl {
          display: flex;
          gap: 10px;
          align-items: center;
          background: rgba(255,255,255,0.05);
          padding: 8px 15px;
          border-radius: 6px;
          flex-shrink: 0;
      }

      input[type="range"] {
          width: 100px;
          height: 4px;
          background: rgba(255,255,255,0.1);
          border-radius: 2px;
          -webkit-appearance: none;
      }

      input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 14px;
          height: 14px;
          background: var(--primary);
          border-radius: 50%;
          cursor: pointer;
      }

      #console {
          background: var(--background);
          border: 1px solid rgba(255,255,255,0.1);
          color: #00ff9d;
          padding: 15px;
          border-radius: 8px;
          font-family: 'Fira Code', monospace;
          font-size: 14px;
          max-height: 150px;
          overflow-y: auto;
      }

      h2 {
          margin-top: 0;
          color: var(--secondary);
          font-size: 1.2rem;
      }

      .selectors {
          display: flex;
          gap: 10px;
          margin-bottom: 15px;
          flex-wrap: wrap;
      }

      @media (max-width: 768px) {
          #main-container {
              flex-direction: column;
              padding: 10px;
          }

          #editor-container, #output-container {
              width: 100%;
              min-width: auto;
              padding: 15px;
          }

          #editor {
              height: 300px !important;
          }

          #arrayContainer {
              height: 300px;
              padding: 10px;
          }

          .bar {
              width: 20px;
              margin: 0 1px;
          }

          .bar span {
              font-size: 10px;
              top: -20px;
          }

          header {
              font-size: 1.2rem;
              padding: 1rem;
          }

          h2 {
              font-size: 1.1rem;
          }

          button {
              padding: 6px 12px;
              font-size: 0.9rem;
          }

          select {
              padding: 6px 10px;
              font-size: 0.9rem;
          }
      }

      @media (max-width: 480px) {
          #controls {
              flex-direction: column;
              align-items: stretch;
          }

          #speedControl {
              width: 100%;
              justify-content: space-between;
          }

          .selectors {
              flex-direction: column;
          }

          #arrayContainer {
              height: 250px;
          }

          .bar {
              width: 15px;
              font-size: 12px;
          }

          .bar span {
              top: -18px;
          }
      }
  </style>
</head>
<body>

  <header>
      Algorithm Visualizer
  </header>

  <div id="main-container">
      <div id="editor-container">
          <h2>Write Your Algorithm</h2>
          <select id="language-selector">
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
          </select>
          <select id="algorithm-selector">
              <option value="bubble">Bubble Sort</option>
              <option value="selection">Selection Sort</option>
              <option value="insertion">Insertion Sort</option>
          </select>
          <div id="editor"></div>
          <button id="run-code">Run Code</button>
      </div>

      <div id="output-container">
          <div id="arrayContainer"></div>
          <div id="controls">
              <div id="generate-container">
                  <button id="generate">Generate Array</button>
              </div>
              <div id="speedControl">
                  <label for="speed">Speed:</label>
                  <input type="range" id="speed" min="50" max="1000" step="50" value="500">
              </div>
          </div>
          <div id="console"></div>
      </div>
  </div>

  <script>
let array = [];
const container = document.getElementById('arrayContainer');
const consoleOutput = document.getElementById('console');
const speedControl = document.getElementById('speed');
let editor;
let speed = 500;
let pyodideInstance;

const algorithms = {
    javascript: {
        bubble: `async function bubbleSort(arr) {
    for (let i = 0; i < arr.length - 1; i++) {
        for (let j = 0; j < arr.length - i - 1; j++) {
            await visualizeStep(arr, [j, j+1], []);
            if (arr[j] > arr[j + 1]) {
                [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                await visualizeStep(arr, [j, j+1], []);
            }
        }
        await visualizeStep(arr, [], [arr.length - i - 1]);
    }
    await visualizeStep(arr, [], Array.from({length: arr.length}, (_, i) => i));
}
bubbleSort(array);`,

        selection: `async function selectionSort(arr) {
    for (let i = 0; i < arr.length - 1; i++) {
        let minIndex = i;
        for (let j = i + 1; j < arr.length; j++) {
            await visualizeStep(arr, [j, minIndex], []);
            if (arr[j] < arr[minIndex]) {
                minIndex = j;
            }
        }
        if (minIndex !== i) {
            [arr[i], arr[minIndex]] = [arr[minIndex], arr[i]];
            await visualizeStep(arr, [i, minIndex], []);
        }
        await visualizeStep(arr, [], [i]);
    }
    await visualizeStep(arr, [], Array.from({length: arr.length}, (_, i) => i));
}
selectionSort(array);`,

        insertion: `async function insertionSort(arr) {
    for (let i = 1; i < arr.length; i++) {
        let key = arr[i];
        let j = i - 1;
        await visualizeStep(arr, [i], []);
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            await visualizeStep(arr, [j, j+1], []);
            j--;
        }
        arr[j + 1] = key;
        await visualizeStep(arr, [], [j+1]);
    }
    await visualizeStep(arr, [], Array.from({length: arr.length}, (_, i) => i));
}
insertionSort(array);`
    },
    python: {
        bubble: `async def bubble_sort(arr):
    for i in range(len(arr) - 1):
        for j in range(len(arr) - i - 1):
            await visualize_step(arr, [j, j+1], [])
            if arr[j] > arr[j + 1]:
                arr[j], arr[j + 1] = arr[j + 1], arr[j]
                await visualize_step(arr, [j, j+1], [])
        await visualize_step(arr, [], [len(arr) - i - 1])
    await visualize_step(arr, [], list(range(len(arr))))
await bubble_sort(array)`,

        selection: `async def selection_sort(arr):
    for i in range(len(arr) - 1):
        min_index = i
        for j in range(i + 1, len(arr)):
            await visualize_step(arr, [j, min_index], [])
            if arr[j] < arr[min_index]:
                min_index = j
        if min_index != i:
            arr[i], arr[min_index] = arr[min_index], arr[i]
            await visualize_step(arr, [i, min_index], [])
        await visualize_step(arr, [], [i])
    await visualize_step(arr, [], list(range(len(arr))))
await selection_sort(array)`,

        insertion: `async def insertion_sort(arr):
    for i in range(1, len(arr)):
        key = arr[i]
        j = i - 1
        await visualize_step(arr, [i], [])
        while j >= 0 and arr[j] > key:
            arr[j + 1] = arr[j]
            await visualize_step(arr, [j, j+1], [])
            j -= 1
        arr[j + 1] = key
        await visualize_step(arr, [], [j+1])
    await visualize_step(arr, [], list(range(len(arr))))
await insertion_sort(array)`
    }
};

require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs' } });
require(["vs/editor/editor.main"], function () {
    editor = monaco.editor.create(document.getElementById('editor'), {
        value: algorithms.javascript.bubble,
        language: "javascript",
        theme: "vs-dark",
        automaticLayout: true,
        minimap: { enabled: false },
        fontSize: 14,
        lineNumbers: "on",
        scrollbar: {
            vertical: "visible",
            horizontal: "visible"
        }
    });
});

async function initializePyodide() {
    if (!pyodideInstance) {
        pyodideInstance = await loadPyodide({
            indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/"
        });
        await pyodideInstance.loadPackage("micropip");
    }
    return pyodideInstance;
}

function logToConsole(message) {
    consoleOutput.innerHTML += `<div>> ${message}</div>`;
    consoleOutput.scrollTop = consoleOutput.scrollHeight;
}

function generateArray(num = 20) {
    array = Array.from({length: num}, () => Math.floor(Math.random() * 280) + 20);
    container.innerHTML = array.map(value => `
        <div class="bar" style="height: ${value}px">
            <span>${value}</span>
        </div>
    `).join('');
    logToConsole('Generated new array');
}

function updateVisualization(arr, comparingIndices = [], sortedIndices = []) {
    const bars = container.getElementsByClassName('bar');
    arr.forEach((value, i) => {
        bars[i].style.height = `${value}px`;
        bars[i].querySelector('span').textContent = value;
        bars[i].className = 'bar' + 
            (comparingIndices.includes(i) ? ' comparing' : '') +
            (sortedIndices.includes(i) ? ' sorted' : '');
    });
}

async function visualizeStep(arr, comparingIndices = [], sortedIndices = []) {
    // Convert Pyodide proxy objects to JS arrays
    if (typeof comparingIndices?.includes !== 'function') {
        comparingIndices = Array.from(comparingIndices || []);
    }
    if (typeof sortedIndices?.includes !== 'function') {
        sortedIndices = Array.from(sortedIndices || []);
    }
    updateVisualization(arr, comparingIndices, sortedIndices);
    await new Promise(resolve => setTimeout(resolve, speed));
}

async function runCode() {
    consoleOutput.innerHTML = '';
    const code = editor.getValue();
    const language = document.getElementById('language-selector').value;
    
    try {
        if (language === 'javascript') {
            const originalLog = console.log;
            console.log = msg => logToConsole(msg);
            await new Function('array', 'visualizeStep', code)(array, visualizeStep);
            console.log = originalLog;
        } else if (language === 'python') {
            const pyodide = await initializePyodide();
            pyodide.globals.set('array', array);
            pyodide.globals.set('visualize_step', visualizeStep);
            pyodide.globals.set('log_to_console', logToConsole);
            
            await pyodide.runPythonAsync(`
import sys
import asyncio
sys.stdout.write = log_to_console
            `);
            
            await pyodide.runPythonAsync(code);
        }
        logToConsole("Execution completed successfully");
    } catch (error) {
        logToConsole(`Error: ${error.message}`);
    }
}

document.getElementById('run-code').addEventListener('click', runCode);
document.getElementById('generate').addEventListener('click', () => generateArray());
document.getElementById('algorithm-selector').addEventListener('change', function() {
    const lang = document.getElementById('language-selector').value;
    editor.setValue(algorithms[lang][this.value]);
});
document.getElementById('language-selector').addEventListener('change', function() {
    const algorithm = document.getElementById('algorithm-selector').value;
    editor.setValue(algorithms[this.value][algorithm]);
    monaco.editor.setModelLanguage(editor.getModel(), this.value);
});
document.getElementById('speed').addEventListener('input', e => {
    speed = 1000 - parseInt(e.target.value);
});

// Initial array generation
generateArray();
  </script>
</body>
</html>